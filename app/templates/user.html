{% extends "layout.html" %}
{% block content %}

<div class="content-card">

    <div class="profile-header">
        <!-- Profile Picture -->
        <div class="profile-pic-wrapper">
            <form id="profile-pic-form" action="{{ url_for('main.profile') }}" method="POST" enctype="multipart/form-data">
                <label for="profile-pic-input">
                    <img src="{{ current_user.profile_pic or url_for('static', filename='images/default_pfp.png') }}"
                         alt="Profile Picture"
                         class="profile-pic">
                </label>
                <input type="file" id="profile-pic-input" name="profile_pic" accept="image/*"
                       style="display:none;" onchange="document.getElementById('profile-pic-form').submit();">
            </form>
            <small>Click the image to change your picture</small>
        </div>

        <!-- Username -->
        <h2>{{ current_user.username }}</h2>

        <!-- Email -->
        <p>
            <strong>Email:</strong> {{ current_user.email }}
        </p>
    </div>

    <!-- Tabs -->
    <div class="profile-tabs">
        <button class="tab-button active" onclick="showTab('posts')">Posts</button>
        <button class="tab-button" onclick="showTab('comments')">Comments</button>
        <button class="tab-button" onclick="showTab('likes')">Likes</button>
    </div>

    <!-- Content Areas -->
    <div id="posts" class="tab-content">
        {% if user_posts %}
            {% for post in user_posts %}
                <div class="post-item">
                    <p>{{ post.content }}</p>
                    <small>{{ post.date_posted }}</small>
                </div>
            {% endfor %}
        {% else %}
            <p class="no-content">No posts yet.</p>
        {% endif %}
    </div>

    <div id="comments" class="tab-content" style="display:none;">
        {% if user_comments %}
            {% for comment in user_comments %}
                <div class="post-item">
                    <p><strong>On:</strong> {{ comment.post_title }}</p>
                    <p>{{ comment.content }}</p>
                    <small>{{ comment.date_posted }}</small>
                </div>
            {% endfor %}
        {% else %}
            <p class="no-content">No comments yet.</p>
        {% endif %}
    </div>

    <div id="likes" class="tab-content" style="display:none;">
        {% if user_likes %}
            {% for like in user_likes %}
                <div class="post-item">
                    <p>❤️ Liked: <strong>{{ like.post_title }}</strong></p>
                    <small>{{ like.date_liked }}</small>
                </div>
            {% endfor %}
        {% else %}
            <p class="no-content">No likes yet.</p>
        {% endif %}
    </div>
</div>

<script>
function showTab(tabName) {
    // Hide all tab contents
    document.querySelectorAll('.tab-content').forEach(t => t.style.display = 'none');
    // Remove active state from all buttons
    document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
    // Show the selected tab and highlight its button
    document.getElementById(tabName).style.display = 'block';
    
    // Find the button that was clicked and add 'active' class
    // We use event.currentTarget to ensure we get the button element
    const buttons = document.querySelectorAll('.tab-button');
    buttons.forEach(button => {
        if (button.getAttribute('onclick') === `showTab('${tabName}')`) {
            button.classList.add('active');
        }
    });
}

// Ensure the first tab is shown on page load
document.addEventListener('DOMContentLoaded', function() {
    document.querySelector('.tab-button.active').click();
});
</script>

{% endblock %}